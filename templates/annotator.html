{% extends '_layout_simple.html' %}

{% block title %}
Annotator
{% endblock %}

{% block style %}
<!-- jquery UI style -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />

<!-- code mirror style -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.css" />
<meta name="metro4:init" content="false">

<style id="app_style">
{% include 'css/box-0.2.0.css' %}
html,body {
    overflow: hidden;
    font-size: 12px;
}
.h-splitter {
    width: 5px;
    height: 100%;
    background-color: #e9e9e9;
}
.h-splitter-menu {
    width: 1px;
    height: 64px;
    background-color: #dadbdc;
}
.v-splitter {
    width: 100%;
    height: 5px;
    background-color: #e9e9e9;
}
#mui_filelist {
    overflow-y: hidden;
    width: 250px;
}
#mui_filelist_toolbar {
    height: 32px;
    border-bottom: 1px solid #cccccc;
}
#mui_filelist_list {
    height: calc(100% - 32px);
    overflow-y: auto;
}
#mui_texteditor {
    width: calc(100% - 250px); 
    height: 100%;
}
#mui_dtdlist {
    overflow-y: auto;
    width: 250px;
}
#mui_annlist {
    padding-left: 5px;
    overflow-y: auto; 
    width: calc(100% - 250px);
}
#mui_stat_summary {
    width: 250px;
}
#mui_stat_charts {
    width: calc(100% - 250px);
}
#mui_iaa_summary {
    width: 240px;
    border-right: 1px solid #e9e9e9;
    overflow-y: auto;
}
#mui_iaa_anns {
    width: 300px;
    padding-right: 5px;
    border-right: 1px solid #e9e9e9;
    overflow-y: auto;
}
#mui_iaa_tags {
    width: calc(100% - 550px);
    padding-right: 5px;
    /* border-right: 1px solid #e9e9e9; */
    overflow-y: auto;
}
#app_hotpot {
    margin-top: 2px;
}
.dropzone:hover {
  border-color: rgb(0, 89, 255);
  font-weight: bold;
}
.disabled-zone {
    opacity: .5;
}
.zone-text {
    margin-top: 9px; 
    line-height: 14px;
    padding-left: 5px;
    padding-right: 5px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
#dropzone_dtd {
    width: 176px;
    height: 60px;
    line-height: 60px;
    text-align: center;
    font-size: 1em;
    border: 1px dotted rgb(17, 61, 110);
    border-radius: 4px;
}
#dropzone_ann {
    width: 176px;
    height: 60px;
    line-height: 60px;
    text-align: center;
    font-size: 1em;
    border: 1px dotted rgb(17, 61, 110);
    border-radius: 4px;
}
#dropzone_txt {
    width: 176px;
    height: 60px;
    line-height: 60px;
    text-align: center;
    font-size: 1em;
    border: 1px dotted rgb(17, 61, 110);
    border-radius: 4px;
}
.dropzone-iaa {
    width: 176px;
    height: 60px;
    line-height: 60px;
    text-align: center;
    font-size: 1em;
    border: 1px dotted rgb(17, 61, 110);
    border-radius: 4px;
}
.tag-list-row {
    
}
.tag-list-row-actived {
    background-color: #efefef;
}
.badge-shortcut {
    padding: 1px 1px 1px 2px;
    font-size: 10px;
    font-family: 'Courier New', Courier, monospace;
    color: black;
    background-color: #EAEAEA;
    border: 1px solid #EFEFEF;
    border-right: 1px solid #cccccc;
    border-bottom: 1px solid #cccccc;
}
.mark-hint {
    cursor: pointer;
    border: 2px dotted #999999;
    position: relative;
    /* display: inline-block; */
}
.mark-hint:hover {
    font-weight: bold;
    border: 2px dotted #333333;
}
.mark-hint-info {
    margin: 0 5px 0 0;
    padding: 0px 4px;
    color: white;
}
.mark-hint-text {

}
.mark-hint .mark-hint-tooltip {
    visibility: hidden;
    min-width: 100px;
    width: auto;
    background-color: #cccccc;
    color: black;
    text-align: center;
    font-size: .9em;
    font-weight: normal;
    font-family: sans-serif;
    border-radius: 6px;
    padding: 1px 5px;
    position: absolute;
    z-index: 999;
    top: 135%;
    left: 50%;
    margin-left: -50%;
    opacity: 0;
    transition: opacity 0.3s;
}
.mark-hint .tooltiptext::after {
    content: "";
    position: absolute;
    top: 130%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: transparent transparent #cccccc transparent;
}
.mark-hint:hover .mark-hint-tooltip {
    visibility: visible;
    opacity: 1;
}
.mark-tag {
    border-radius: 3px;
    padding: 1px 3px;
    margin-right: 0;
    cursor: pointer;
    border: 1px solid white;
}
.mark-tag:hover{
    border-color: red;
}
.mark-tag-hover {    
    border: 2px dotted red;
}
.mark-tag-info {
    font-size: .75em;
    margin: 0 5px 0 0;
    padding: 0px 2px;
    background: white;
    border-radius: 4px;
}
.mark-tag-info-inline {
}
.mark-tag-info-offset {
    position: relative;
    right: -.7em;
    top: -.7em;
    font-size: .85em;
    color: transparent;
    border-radius: .5em;
}
.mark-tag:hover .mark-tag-info-offset{
    display: inline;
    position: relative;
    right: -.7em;
    top: -.7em;
    font-size: .85em;
    color: grey;
    background-color: white;
}
.mark-tag:hover .mark-tag-info-offset:hover {
    color: black;
    background-color: white;
}
.mark-tag-text {
    margin-right: -.5em;
}
.mark-round {
    border-radius: 8px;
    padding: 0 1px 0 0;
    color: black !important;
}
#cm_editor {
    height: 100%;
}
.CodeMirror {
    height: 100%;
    font-size: 14px;
    line-height: 2em;
}
.CodeMirror-activeline-background {
    background-color: #e3f3fb;
}
.CodeMirror-plots {
    position: absolute;
    width: 100%;
    height: 100%;
}
#cm_svg_plots {
    width: 100%;
    height: 100%;
}
.tag-polyline {
	fill: none;
    stroke: black;
    stroke-width: 1;
    /* vector-effect: non-scaling-stroke; */
    /* stroke-dasharray: 2, 1; */
    opacity: .5;
}
.tag-polyline:hover {
    opacity: .95;
}
.tag-linktext {
    font-size: 9px;
    padding: 0 3px;
}
.tag-linktext-bg {
    stroke-width: 0;
    rx: 3px;
    opacity: 1;
}
/* for the pop menu */
#popmenu_tag {
    z-index: 998;
    position: absolute;
    padding: 1px 3px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
}
/* for the context menu */
#ctxmenu_sel {
    z-index: 999;
    position: absolute;
    padding: 1px 3px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
}
.ctxmenu-item {
    padding: 1px;
    cursor: pointer;
}
.ctxmenu-item:hover {
    background-color: rgb(221, 221, 221);
}
.ctxmenu-divider {
    height: 2px;
    margin: 2px 0;
    background-color: #dfdfdf;
}
.ui-widget-header {
    border: 0;
    height: 2em;
    line-height: 2em;
    text-indent: 0.5em;
    background-color: #EAEAEA;
}
.file-list {
    font-size: .9em;
    padding: 2px;
}
.file-list li {
    border-bottom: 1px dotted #eeeeee;
}
.file-list li.file-selected {
    font-weight: bold;
    background-color: #EFEFEF;
    border-left: 3px solid #1ba1e2;
    padding-left: 5px;
}
.file-list-item {
    margin-bottom: 1px;
}
.file-list-item:hover {
    background-color: #e9e8e8;
}
.file-list-item-name {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    cursor: pointer;
}
.file-list-item-name-unsaved {
    font-style: italic;
}
/* tag list */
.tag-list {
    font-size: 1em;
    padding: 2px;
}
.tag-list li {
    padding: 2px 0;
    border-bottom: 1px dotted #eeeeee;
}
.tag-list li:hover {
    background-color: #EAEAEA;
}
.tag-list-row-name {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;

    cursor: pointer;
}
.tag-list-row-name-id-prefix {
    font-weight: bold;
    /* text-decoration: underline; */
}
.tag-list-row-count-0 {
    color: #bdbdbd;
    font-size: .95em;
}
.tag-table {
    font-size: .9em;
}
.tag-table th, 
.tag-table td {
    padding: 2px;
}
.tag-table th {
    border-bottom: 1px solid #999999;
    text-align: left;
}
.tag-table th.tag-name {
    max-width: 200px;
    width: 180px;
}
.tag-table th.tag-id {
    max-width: 100px;
    width: 60px;
}
.tag-table th.tag-spans {
    max-width: 200px;
    width: 120px;
}
.tag-table td {
    border-bottom: 1px dotted #aaaaaa;
}
.tag-table tr:hover {
    background-color: #EAEAEA;
}
.tag-table td.td-text {
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.tag-attr-box {
    background-color: whitesmoke;
    border-radius: 3px;
    padding: 1px 5px;
    margin-bottom: 2px;
}
.tag-attr-box:hover{
    background-color: rgb(209, 209, 209);
}
.tag-attr-name {
    font-size: .9em;
}
input[type=text].tag-attr-input {
    padding: 0 3px;
    width: auto;
    max-width: 120px;
    line-height: 1.5em;
    height: 2em;
    display: inline;
    font-size: 1em;
    border: 0;
    border-bottom: 1px solid #999999;
}
select.tag-attr-select {
    padding: 0 3px;
    width: auto;
    max-width: 120px;
    line-height: 1.5em;
    height: 2em;
    display: inline;
    font-size: 1em;
    border: 0;
    border-bottom: 1px solid #999999;
}
.btn {
    padding: 2px 4px;
    border-top: 1px solid #EAEAEA;
    border-left: 1px solid #EAEAEA;
    border-right: 1px solid #aaaaaa;
    border-bottom: 1px solid #aaaaaa;
}
.btn:hover {
    border-top: 1px solid #aaaaaa;
    border-left: 1px solid #aaaaaa;
    border-right: 1px solid #858585;
    border-bottom: 1px solid #858585;
}
.btn:active {
    border-top: 1px solid #858585;
    border-left: 1px solid #858585;
    border-right: 1px solid #aaaaaa;
    border-bottom: 1px solid #aaaaaa;
}
.btn-xs {
    font-size: .9em;
}
.btn-red {
    color: #b99090;
}
.btn-red:hover {
    color: red;
}
input[type=text].ipt-xs {
    font-size: 1em;
    line-height: 1em;
    height: 1.4em;
    padding: 2px 3px;
    max-width: 80px;
    display: inline;
    border: 0;
    border: 1px solid #999999;
}
input[type=text].ipt-md {
    font-size: 1.2em;
    line-height: 1.2em;
    height: 1.6em;
    padding: 2px 3px;
    max-width: 150px;
    display: inline;
    border: 0;
    border: 1px solid #999999;
}
input[type=text].ipt-spinner-xs {
    font-size: 1em;
    line-height: 1em;
    height: 1.4em;
    padding: 2px 3px;
    max-width: 80px;
    display: inline;
    border: 0;
}
.icon-fg-unsaved {
    color: #daaf5f;
}
.icon-fg-unsaved:hover {
    color: #ffa600;
}

.ruleset-tag-item {
    cursor: pointer;
    border-bottom: 1px dotted #ececec;
}
.ruleset-tag-item:hover {
    background-color: whitesmoke;
}
.ruleset-tag-name {
    width: 180px;
    min-width: 180px;
    border-left: 5px solid;
}
.ruleset-tag-text {
    padding: 0px 2px;
}
.ruleset-tag-text-str {
    padding: 0px 3px;
    border-bottom: 1px solid #dadada;
}
.ruleset-tag-text-count {
    padding: 0px 5px;
    background-color: #dadada;
    border-bottom: 1px solid #dadada;
}
.ruleset-tag-text-filelist {
    padding: 1px 0 1px 4px;
    border-left: 1px solid #EFEFEF;
    border-bottom: 1px solid #EFEFEF;
    max-height: 115px;
    overflow-y: auto;
}
.ruleset-tag-text-filelist-item {
    cursor: pointer;
    color: #333333;
    padding: 2px 0;
}
.ruleset-tag-text-filelist-item:hover {
    color: rgb(1, 84, 207);
    background-color: #efefef;
}
.ruleset-tag-text-filelist-item-count {
    padding: 0px 2px;
    background-color: #eaeaea;
}
.iaa-row-header {
    font-weight: bold;
}
.iaa-row {
    border-bottom: 1px dotted #efefef;
    padding-top: 3px;
    padding-bottom: 3px;
    cursor: pointer;
}
.iaa-row-actived {
    background-color: #dfdfdf;
}
.iaa-row:hover {
    background-color: #efefef;
}
.iaa-bar {
    background-color: #1ba1e2;
    height: 1em;
}
.iaa-bar-box {
    width: 120px;
}
.iaa-bar-name-box {
    width: 100px;
}
.iaa-bar-filename {
    font-size: 0.8em;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.iaa-bar-value {
    font-size: 0.9em;
    font-weight: bold;
}
.iaa-bar-filename-box {
    width: 150px;
}
.iaa-file-cm-box {
    font-size: 0.8em;
}
.iaa-file-gs-box {
    font-size: 0.8em;
}
.iaa-tag-name {
    text-align: center;
    padding-top: 5px;
    border-top: 2px dotted #dfdfdf;
    /* border-bottom: 1px dashed #dfdfdf; */
}
.iaa-tag-detail {
    /* border-bottom: 1px dashed #dfdfdf; */
    margin-top: 5px;
    margin-bottom: 5px;
}
.iaa-tag-detail:hover {
    background-color: #efefef;
}
.iaa-tag-detail-header {
    /* border-bottom: 1px dashed #dfdfdf; */
    font-weight: bold;
    text-align: center;
    font-size: 1.1em;
    margin-bottom: 5px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.iaa-tag-detail-info {
    border: 1px;
    border-radius: 5px;
    padding: 5px;
}
.iaa-tag-detail-info-tp {
    border: 1px solid #61a51d;
}
.iaa-tag-detail-info-fp {
    border: 1px dotted #ff7878;
}
.iaa-tag-detail-info-fn {
    border: 1px dotted #ff7878;
}
.iaa-tag-detail-info-gs {
    border: 1px dotted #dfdfdf;
}
.iaa-tag-detail-info-text-ab {
    margin-top: 14px;
}
.iaa-tag-detail-info-text-gs {
    margin-top: 14px;
}
.iaa-tag-detail-a {
    margin-right: 5px;
}
.iaa-tag-detail-b {
    margin-right: 5px;
}
.iaa-tag-detail-g-header {
    cursor: pointer;
}
.iaa-tag-detail-g {
    border-left: 1px dotted #dfdfdf;
    padding-left: 4px;
}
.iaa-tag-detail-g:hover {
    border-left-color: #999999;
    background-color: rgb(253, 236, 205);
}
.iaa-tag-detail-oper {
    display: none;
    position: absolute;
    top: -7px;
    left: -6px;
}
.iaa-tag-detail-info:hover 
.iaa-tag-detail-oper {
    display: block;
}
.iaa-tag-attlist {
    border-bottom: 1px solid #aaaaaa;
}
.iaa-tag-attlist-name {
    font-size: 0.8em;
}
.iaa-tag-context {
    font-size: 1.2em;
}
.iaa-w-100 {
    width: 100% !important;
}
.iaa-w-80 {
    width: 80% !important;
}
.iaa-w-50 {
    width: 50% !important;
}
.iaa-w-40 {
    width: 40% !important;
}
.iaa-w-20 {
    width: 20% !important;
}
.iaa-op-50 {
    opacity: 0.5;
}
/* for text display */
.clr-red {
    color: red;
}
/* fix for metro */
.radio .caption, .radio .check {
    font-size: 1em;
}
.switch .caption, .switch .check {
    font-size: 1em;
}
.switch {
    height: 30px;
}
.radio {
    height: 30px;
}
.ribbon-toggle-group .ribbon-icon-button {
    height: 18px;
}
</style>
{% endblock %}

{% block main %}

<div id="start-screen">
    <h1>
        <i class="fa fa-highlighter"></i>
        Annotator
    </h1>
    <div id="ss-msg">Loading data and initializing GUI ...</div>
</div>

<div id="app_hotpot">

    <!-- <div class="container-fluid bg-cyan fg-white mb-1">
        <div class="row">
            <div class="cell">
                <i class="fa fa-code"></i>
                Annotator
            </div>
            <div class="cell">

            </div>
        </div>
    </div> -->

    <nav data-role="ribbonmenu">
        <ul class="tabs-holder">
            <li v-on:click="switch_mui('annotation')"
                v-bind:class="{'active': section=='annotation'}">
                <a id="tab_link_annotation" href="#section-1-1">
                    <i class="fa fa-highlighter"></i>
                    Annotation
                </a>
            </li>
            <li v-on:click="switch_mui('corpus')"
                v-bind:class="{'active': section=='corpus'}">
                <a href="#section-1-2">
                    <i class="fa fa-cubes"></i>
                    Corpus
                </a>
            </li>
            <li v-on:click="switch_mui('statistics')"
                v-bind:class="{'active': section=='statistics'}">
                <a href="#section-1-5">
                    <i class="fa fa-chart-bar"></i>
                    Statistics
                </a>
            </li>
            <li v-on:click="switch_mui('ruleset')"
                v-bind:class="{'active': section=='ruleset'}">
                <a href="#section-1-4">
                    <i class="fa fa-file-export"></i>
                    Export
                </a>
            </li>
            <li v-on:click="switch_mui('iaa')"
                v-bind:class="{'active': section=='iaa'}">
                <a href="#section-1-6">
                    <i class="fa fa-people-arrows"></i>
                    IAA
                </a>
            </li>
        </ul>

        <div class="content-holder">
            <!-- the section for annotation -->
            <div class="section" id="section-1-1" 
                v-bind:class="{'active': section=='annotation'}">

                <div class="group">

                    <div id="dropzone_dtd" class="dropzone"
                        v-on:click="open_dtd_file">
                        <div v-if="dtd != null" class="zone-text">
                            <b>{{ dtd.name }}</b><br>
                            {{ dtd.etags.length }} Entity Tags<br>
                            {{ dtd.ltags.length }} Link Tags
                        </div>
                        <div v-else>
                            Drop <b>Schema</b> File Here
                        </div>
                    </div>

                    <!-- <button class="ribbon-button"
                        v-on:click="open_dtd_file">
                        <span class="icon">
                            <i class="far fa-file"></i>
                        </span>
                        <span class="caption">Open DTD</span>
                    </button> -->

                    <span class="title">Schema DTD File (.dtd)</span>
                </div>

                <div v-show="dtd != null" class="group">

                    <div id="dropzone_ann" 
                        v-on:click="open_ann_files"
                        v-bind:class="{'disabled-zone': dtd == null, 'dropzone': dtd != null}">
                        <div v-if="ann_idx != null" class="zone-text">
                            <b>{{ anns[ann_idx]._filename }}</b><br>
                            {{ anns[ann_idx].text.length }} chars<br>
                            {{ anns[ann_idx].tags.length }} tags
                        </div>
                        <div v-else>
                            Drop <b>Annotation</b> File(s) Here
                        </div>
                    </div>

                    <!-- <button class="ribbon-button"
                        v-on:click="open_ann_files">
                        <span class="icon">
                            <i class="far fa-file-code"></i>
                        </span>
                        <span class="caption">Open XMLs</span>
                    </button> -->

                    <span class="title">Annotation File (.xml)</span>
                </div>

                <div v-if="ann_idx != null"
                    class="group">
                    <button class="ribbon-button"
                        v-on:click="save_xml">
                        <span class="icon">
                            <i class="far fa-save"></i>
                        </span>
                        <span class="caption">Save</span>
                    </button>
 
                    <button class="ribbon-button"
                        v-on:click="save_as_xml">
                        <span class="icon">
                            <i class="far fa-copy"></i>
                        </span>
                        <span class="caption">Save as</span>
                    </button>
                    <a id="downloadAnchorElem" style="display:none"></a>

                    <span class="title">Save</span>
                </div>

                <!-- <div class="group">
                    <div>
                        <input type="radio" name="mode" data-role="radio" data-caption="Normal" checked><br>
                        <input type="radio" name="mode" data-role="radio" data-caption="Discontiguous" >
                    </div>
                    <span class="title">Annotation Mode</span>
                </div> -->

                <div class="group">
                    <div>
                        <input type="radio" name="display_mode" value="document" 
                            data-role="radio" 
                            data-caption="<i class='far fa-file-alt'></i> Document" checked 
                            v-model="cm.display_mode"
                            @change="on_change_display_mode">
                        <br>
                        <input type="radio" name="display_mode" value="sentences" 
                            data-role="radio" 
                            data-caption="<i class='fa fa-list'></i> Sentences" 
                            v-model="cm.display_mode"
                            @change="on_change_display_mode">
                    </div>

                    <!-- <div class="ribbon-toggle-group">
                        <button class="ribbon-icon-button active"
                            v-on:click="on_change_display_mode('document')">
                            <span class="icon">
                                <i class='far fa-file-alt'></i>
                            </span>
                            <span class="caption">Document</span>
                        </button>
    
                        <button class="ribbon-icon-button"
                            v-on:click="on_change_display_mode('smart')">
                            <span class="icon">
                                <i class='fa fa-list'></i>
                            </span>
                            <span class="caption">Sentences</span>
                        </button>
                    </div> -->

                    <span class="title">Display Mode</span>
                </div>

                <div class="group">
                    <div>
                        <input type="radio" name="mark_mode" value="node" 
                            data-role="radio" 
                            data-caption="<i class='fa fa-broom'></i> Rich Text" checked 
                            v-model="cm.mark_mode"
                            @change="on_change_mark_mode">
                        <br>
                        <input type="radio" name="mark_mode" value="span" 
                            data-role="radio" 
                            data-caption="<i class='fa fa-pen'></i> Simple" 
                            v-model="cm.mark_mode"
                            @change="on_change_mark_mode">
                    </div>
                    <span class="title">Mark Mode</span>
                </div>

                <div class="group">
                    <div class="ribbon-toggle-group">
                        <button class="ribbon-icon-button active"
                            v-on:click="on_change_hint_mode('simple')">
                            <span class="icon">
                                <span class="mif-list"></span>
                            </span>
                            <span class="caption">Simple</span>
                        </button>
    
                        <button class="ribbon-icon-button"
                            v-on:click="on_change_hint_mode('smart')">
                            <span class="icon">
                                <span class="fa fa-magic"></span>
                            </span>
                            <span class="caption">Smart</span>
                        </button>
    
                        <button class="ribbon-icon-button"
                            v-on:click="on_change_hint_mode('off')">
                            <span class="icon">
                                <span class="fa fa-toggle-off"></span>
                            </span>
                            <span class="caption">Off</span>
                        </button>
                    </div>

                    <div>

                        <button class="ribbon-button" 
                            v-on:click="accept_all_hints">
                            <span class="icon">
                                <i class="fa fa-check-double"></i>
                            </span>
                            <span class="caption">Accept All</span>
                        </button>
                        
                    </div>
    
                    <span class="title">Hint Mode</span>
                </div>
                
                <div class="group">
                    <div>
                        <input type="checkbox" 
                            class="check"
                            data-role="switch" 
                            data-caption="Show Links"
                            v-model="cm.enabled_links"
                            @change="on_change_link_settings">
                        <br>
                        
                        <input type="checkbox" 
                            class="check"
                            data-role="switch" 
                            data-caption="Link Name"
                            v-model="cm.enabled_link_name"
                            @change="on_change_link_settings">
                    </div>

                    <div v-show="is_linking">
                        <button class="ribbon-button"
                            v-on:click="cancel_linking">
                            <span class="icon">
                                <span class="far fa-times-circle"></span>
                            </span>
                            <span class="caption">Cancel Linking</span>
                        </button>
                    </div>
                    <span class="title">Link Marks</span>
                </div>

                <div class="group">

                    <button class="ribbon-button" 
                        v-on:click="show_about">
                        <span class="icon">
                            <i class="fa fa-info"></i>
                        </span>
                        <span class="caption">About</span>
                    </button>

                    <span class="title">Help</span>
                </div>

            </div>

            <!-- the section for corpus schema -->
            <div class="section" id="section-1-2"
                v-bind:class="{'active': section=='corpus'}">

                <div class="group">
                    <button class="ribbon-button"
                        v-on:click="clear_corpus_all">
                        <span class="icon">
                            <i class="far fa-times-circle"></i>
                        </span>
                        <span class="caption">Clear All</span>
                    </button>

                    <span class="title">&nbsp;</span>
                </div>

                <div class="group">
                    <div id="dropzone_txt" class="dropzone">
                        <div v-if="txt_anns.length == 0" class="zone-text">
                            Drop <b>Raw Text</b> File <br>
                            Here
                        </div>
                        <div v-else>
                            {{ txt_anns.length }} txt files
                        </div>
                    </div>

                    <button class="ribbon-button"
                        :disabled="dtd == null"
                        v-on:click="open_txt_files">
                        <span class="icon">
                            <i class="far fa-file-code"></i>
                        </span>
                        <span class="caption">Open .txt Files</span>
                    </button>

                    <span class="title">Raw Text Files</span>
                </div>
                
                <div class="group">
                    
                    <div class="d-flex flex-column ml-2">
                        <div class="mt-1 mb-2">
                            <label for="">Prefix for XML Files</label>
                            <input type="text" class="ipt-md"
                                v-model="txt_xml_prefix">
                        </div>
                        <div>
                            <label for="">Suffix for XML Files</label>
                            <input type="text" class="ipt-md"
                                v-model="txt_xml_suffix">
                        </div>
                    </div>

                    <button class="ribbon-button"
                        :disabled="dtd == null || txt_anns.length == 0"
                        v-on:click="convert_txt_anns_to_xmls">
                        <span class="icon">
                            <i class="far fa-file-code"></i>
                        </span>
                        <span class="caption">Convert to XMLs</span>
                    </button>

                    <span class="title">Annotation XML File</span>
                </div>
                
                <div class="group">

                    <button class="ribbon-button"
                        :disabled="txt_xmls.length == 0 || txt_xmls.length != txt_anns.length"
                        v-on:click="download_txt_xmls_as_zip">
                        <span class="icon">
                            <i class="fa fa-download"></i>
                        </span>
                        <span class="caption">All as a ZIP</span>
                    </button>

                    <span class="title">Download</span>
                </div>

            </div>

            <!-- the section for adju operations -->
            <div class="section" id="section-1-3"
                v-bind:class="{'active': section=='adjudication'}">
                <div v-if="dtd != null" 
                    class="group">

                    <button class="ribbon-button"
                        v-for="etag in dtd.etags">
                        <span class="icon">
                            <i class="fa fa-cube"></i>
                        </span>
                        <span class="caption">{{ etag.name }}({{ etag.id_prefix }})</span>
                    </button>

                    <span class="title">Extend Tags</span>
                </div>
                

                <div v-if="dtd != null && dtd.ltags.length > 0" 
                    class="group">

                    <button class="ribbon-button"
                        v-for="ltag in dtd.ltags">
                        <span class="icon">
                            <i class="fa fa-link"></i>
                        </span>
                        <span class="caption">{{ ltag.name }}</span>
                    </button>

                    <span class="title">Link Tags</span>
                </div>
            </div>

            <!-- the section for iaa -->
            <div class="section" id="section-1-6"
                v-bind:class="{'active': section=='iaa'}">

                <div class="group">
                    <button class="ribbon-button"
                        v-on:click="clear_iaa_all">
                        <span class="icon">
                            <i class="far fa-times-circle"></i>
                        </span>
                        <span class="caption">Clear All</span>
                    </button>

                    <span class="title">&nbsp;</span>
                </div>

                <div class="group">

                    <div id="dropzone_iaa_0" class="dropzone-iaa"
                        iaa_id="0">
                        <div v-if="dtd == null" class="zone-text">
                            Load DTD file first<br>
                            in Annotation Tab
                        </div>
                        <div v-else-if="iaa_ann_list[0].anns.length == 0" class="zone-text">
                            Drop <b>Ann</b> File(s)<br>
                            Annotator <b>A</b>
                        </div>
                        <div v-else class="zone-text">
                            <b>Annotator A</b><br>
                            Annotated {{ count_tags_in_anns(iaa_ann_list[0].anns) }} Tags
                            <br>
                            in {{ iaa_ann_list[0].anns.length }} Files
                        </div>
                    </div>

                    <div class="h-splitter-menu ml-2 mr-2">&nbsp;</div>

                    <div id="dropzone_iaa_1" class="dropzone-iaa"
                        iaa_id="1">
                        <div v-if="dtd == null" class="zone-text">
                            Load DTD file first<br>
                            in Annotation Tab
                        </div>
                        <div v-else-if="iaa_ann_list[1].anns.length == 0" class="zone-text">
                            Drop <b>Ann</b> File(s)<br>
                            Annotator <b>B</b>
                        </div>
                        <div v-else class="zone-text">
                            <b>Annotator B</b><br>
                            Annotated {{ count_tags_in_anns(iaa_ann_list[1].anns) }} Tags
                            <br>
                            in {{ iaa_ann_list[1].anns.length }} Files
                        </div>
                    </div>

                    <span class="title">Annotation Files</span>
                </div>

                <div class="group">
                    <div class="mr-1">
                        <input type="radio" name="match_mode" 
                            value="overlap" 
                            data-role="radio" 
                            data-caption="<i class='fa fa-align-center'></i> Overlap" checked 
                            v-model="iaa_match_mode"
                            @change="on_change_iaa_settings">
                        <br>
                        <input type="radio" name="match_mode" 
                            value="exact" 
                            data-role="radio" 
                            data-caption="<i class='fa fa-align-justify'></i> Exact" 
                            v-model="iaa_match_mode"
                            @change="on_change_iaa_settings">
                    </div>
                    
                    <div v-if="iaa_match_mode == 'overlap'"
                        class="p-1 ml-1 mr-1 border bd-gray border-radius">

                        <div class="mt-1 mb-1">
                            <i class="fa fa-percentage"></i>
                            Overlap Ratio
                        </div>

                        <div>        
                            <input id="iaa_form_overlap_ratio" 
                                name="iaa_form_overlap_ratio" 
                                style="width: 36px"
                                type="text" class="ipt-md" 
                                v-model.number="iaa_overlap_ratio">
                            <span class="mr-1">
                                %
                            </span>

                            <button title="Reset the overlap ratio"
                                v-on:click="iaa_overlap_ratio = iaa_overlap_ratio_default">
                                <i class="fa fa-undo"></i>
                            </button>
                        </div>
                    </div>

                    <button class="ribbon-button"
                        v-on:click="calc_iaa">
                        <span class="icon">
                            <i class="fa fa-calculator"></i>
                        </span>
                        <span class="caption">Calculate All</span>
                    </button>

                    <span class="title">IAA</span>
                </div>
                
                <div class="group">
                    <div>
                        <input type="checkbox" 
                            class="check"
                            data-role="switch" 
                            data-caption="Show Agreed Tags"
                            v-model="iaa_display_tags_tp"
                            @change="on_change_iaa_settings">
                        <br>

                        <input type="checkbox" 
                            class="check"
                            data-role="switch" 
                            data-caption="Show Context"
                            v-model="iaa_display_tags_context"
                            @change="on_change_iaa_settings">

                    </div>
                    <span class="title">Tag Display</span>
                </div>

                
                <div class="group">
                    <div>
                        <input type="checkbox" 
                            class="check"
                            data-role="switch" 
                            data-caption="Adj. Panel"
                            v-model="iaa_display_adj_panel"
                            @change="on_change_iaa_settings">
                        <br>

                        <input type="checkbox" 
                            class="check"
                            data-role="switch" 
                            data-caption="Tag Detail"
                            v-model="iaa_display_adj_detail"
                            @change="on_change_iaa_settings">

                    </div>

                    <div class="h-splitter-menu ml-2 mr-2">&nbsp;</div>

                    <div>
                        <button class="ribbon-button" 
                            :disabled="dtd == null || iaa_dict == null"
                            v-on:click="make_default_adj">
                            <span class="icon">
                                <i class="far fa-object-group"></i>
                            </span>
                            <span class="caption">Reset G.S.</span>
                        </button>
                    </div>

                    <div>
                        <button class="ribbon-button" 
                            :disabled="dtd == null"
                            v-on:click="download_all_goldstandards">
                            <span class="icon">
                                <i class="fa fa-file-download"></i>
                            </span>
                            <span class="caption">Download All</span>
                        </button>
                    </div>
                    
                    <span class="title">Adjudication</span>
                </div>

            </div>


            <!-- the section for ruleset -->
            <div class="section" id="section-1-4"
                v-bind:class="{'active': section=='ruleset'}">
                <div class="group">
                    <button class="ribbon-button" 
                        :disabled="dtd == null"
                        v-on:click="update_hint_dict">
                        <span class="icon">
                            <i class="fa fa-sync"></i>
                        </span>
                        <span class="caption">Refresh</span>
                    </button>

                    <span class="title">Rules</span>    
                </div>

                <div class="group">
                    <button class="ribbon-button" 
                        :disabled="dtd == null"
                        v-on:click="download_ruleset_medtagger_zip">
                        <span class="icon">
                            <i class="far fa-file-archive"></i>
                        </span>
                        <span class="caption">MedTagger (.zip)</span>
                    </button>

                    <div class="h-splitter-menu ml-2 mr-2">&nbsp;</div>

                    <button class="ribbon-button" 
                        :disabled="dtd == null"
                        v-on:click="download_ruleset_spacy_jsonl">
                        <span class="icon">
                            <i class="far fa-file-code"></i>
                        </span>
                        <span class="caption">spaCy (.jsonl)</span>
                    </button>
                    <span class="title">Download Ruleset</span>
                </div>
            </div>

            <!-- the section for statistics -->
            <div class="section" id="section-1-5"
                v-bind:class="{'active': section=='statistics'}">
                <button class="ribbon-button" 
                    :disabled="dtd == null"
                    v-on:click="show_about">
                    <span class="icon">
                        <i class="fa fa-list-ul"></i>
                    </span>
                    <span class="caption">Update All</span>
                </button>
                
            </div>
        </div>

    </nav>

    <!-- the ui for main annotation -->
    <div v-show="section=='annotation'" id="main_ui" 
        class="main-ui container-fluid">
        <div class="d-flex flex-row flex-justify-start flex-align-start w-100"
            style="height: 60%;">
            <div id="mui_filelist"
                class="d-flex flex-column flex-justify-start flex-align-start h-100">
                <div id="mui_filelist_toolbar"
                    class="d-flex flex-row flex-justify-between flex-align-center w-100">
                    <div class="d-flex flex-row flex-justify-start flex-align-center mr-1">
                        <span class="mr-1">Filter: </span>
                        <input type="text" class="ipt-xs mr-1"
                            v-model="fn_pattern">
                    
                        <span v-if="anns.length > 0">
                            {{ anns.length }} files
                        </span>
                    </div>

                    <div class="d-flex flex-row flex-justify-start flex-align-center mr-1">
                        <button class="btn-xs"
                            title="Remove all files"
                            v-on:click="remove_all_ann_files">
                            <i class="fa fa-sign-out-alt"></i>
                            All
                        </button>
                    </div>
                </div>
                <div id="mui_filelist_list" 
                    class="d-flex flex-column flex-justify-start flex-align-start w-100 h-100">

                    <ul class="w-100 file-list">
                        <li v-for="ann, idx in anns"
                            v-show="idx == ann_idx || is_match_filename(ann._filename)"
                            v-bind:class="{'file-selected':idx == ann_idx}"
                            class="file-list-item">
                            <div v-bind:title="ann._filename"
                                class="d-flex flex-row flex-justify-between">
                                <div class="file-list-item-name"
                                    v-bind:class="{'file-list-item-name-unsaved':!ann._has_saved}">
                                    <a href="javascript:void(0);"
                                        v-show="!ann._has_saved" 
                                        v-on:click="save_xml"
                                        title="Save this annotation file"
                                        class="icon-fg-unsaved mr-1">
                                        <i class="fa fa-save"></i>
                                    </a>
                                    <span v-on:click="set_ann_idx(idx)">
                                        {{ ann._filename }}
                                    </span>
                                </div>

                                <div class="d-flex flex-row">
                                    <div class="mr-2">
                                        {{ ann.tags.length }}
                                    </div>

                                    <div>
                                        <a v-on:click="remove_ann_file(idx)"
                                            class="btn btn-red btn-xs"
                                            href="javascript:void(0);">
                                            <i class="fa fa-sign-out-alt"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="h-100 h-splitter">
            </div>

            <div id="mui_texteditor">
                <div id="cm_editor" class="w-100">
                    
                </div>
            </div>
            
        </div>
        <div class="v-splitter"></div>
        <div class="d-flex flex-row flex-justify-start flex-align-start w-100"
            style="height: 40%;">
            <div id="mui_dtdlist" 
                class="d-flex h-100">
                <ul v-if="dtd != null"
                    class="w-100 tag-list">

                    <li v-on:click="update_tag_table(null)"
                        class="tag-list-row d-flex flex-row flex-justify-between"
                        v-bind:class="{'tag-list-row-actived':display_tag_name == '__all__'}">
                        <div class="tag-list-row-name"
                            v-on:click="display_tag_name = '__all__'">
                            <span class='mif-folder fg-red'></span>
                            All Tags
                        </div>
                        <div class="mr-1">
                            {{ count_n_tags(null) }}
                        </div>
                    </li>

                    <!-- show all etags -->
                    <li v-for="etag in dtd.etags"
                        v-on:click="update_tag_table(etag)"
                        class="tag-list-row d-flex flex-row flex-justify-between"
                        v-bind:class="{'tag-list-row-actived':display_tag_name == etag.name}">
                        <div class="tag-list-row-name"
                            v-on:click="display_tag_name = etag.name">
                            <i class="fa fa-tag"
                                v-bind:class="'fg-tag-' + etag.name">
                            </i>
                            <span v-if="etag.hasOwnProperty('shortcut')"
                                class="badge-shortcut mr-1">
                                {{ etag.shortcut }}
                            </span>
                            <span v-html="make_html_bold_tag_name(etag)">
                                
                            </span>
                        </div>
                        <div class="mr-1 d-flex flex-row">
                            <div v-if="ann_idx != null && etag.is_non_consuming"
                                class="mr-2">
                                <button class="btn-xs"
                                    title="Add an empty entity tag"
                                    v-on:click="add_empty_etag(etag)">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                            <div v-bind:class="'tag-list-row-count-'+count_n_tags(etag)">
                                {{ count_n_tags(etag) }}
                            </div>
                        </div>
                    </li>

                    <!-- show all link tags -->
                    <li v-for="ltag in dtd.ltags"
                        class="tag-list-row d-flex flex-row flex-justify-between"
                        v-bind:class="{'tag-list-row-actived':display_tag_name == ltag.name}">
                        <div class="tag-list-row-name"
                            v-on:click="display_tag_name = ltag.name">
                            <i class="fa fa-link"
                                v-bind:class="'fg-tag-' + ltag.name">
                            </i>
                            <span v-if="ltag.hasOwnProperty('shortcut')"
                                class="badge-shortcut mr-1">
                                {{ ltag.shortcut }}
                            </span>
                            <span v-html="make_html_bold_tag_name(ltag)">
                                
                            </span>
                        </div>
                        <div class="mr-1 d-flex flex-row">
                            <div v-if="ann_idx != null"
                                class="mr-2">
                                <button class="btn-xs"
                                    title="Add an empty link tag"
                                    v-on:click="add_empty_ltag(ltag)">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                            <div v-bind:class="'tag-list-row-count-'+count_n_tags(ltag)">
                                {{ count_n_tags(ltag) }}
                            </div>
                        </div>

                    </li>

                </ul>
            </div>

            <div class="h-100 h-splitter">
            </div>

            <div id="mui_annlist" 
                class="d-flex flex-justify-start flex-align-start h-100">
                <table v-if="dtd!=null && ann_idx != null" class="tag-table w-100 mt-0 mb-0">
                    <thead>
                        <tr>
                            <th class="tag-name">Tag</th>
                            <th class="tag-id">ID</th>
                            <th class="tag-span">Spans</th>
                            <th class="tag-text">Text</th>
                            <th class="tag-attr">Attributes</th>
                        </tr>
                    </thead>
                    <tbody style="overflow-y: auto;">
                        <tr v-for="tag, tag_idx in anns[ann_idx].tags"
                            v-if="tag.tag == display_tag_name || display_tag_name == '__all__'">
                            <td>
                                <div class="d-flex flex-row flex-justify-between">
                                    <div>
                                        <i v-if="get_tag_def(tag.tag).type == 'etag'" 
                                            class="fa fa-tag"
                                            v-bind:class="'fg-tag-' + tag.tag">
                                        </i>
                                        <i v-else class="fa fa-link"
                                            class="fa fa-tag"
                                            v-bind:class="'fg-tag-' + tag.tag">
                                        </i>
                                        {{ tag.tag }}
                                    </div>

                                    <div class="mr-2">
                                        <button class="btn btn-xs btn-red"
                                            title="Delete this tag"
                                            v-on:click="del_tag(tag.id)">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </td>
                            <td>
                                {{ tag.id }}
                            </td>
                            <td>
                                {{ tag.spans }}
                            </td>
                            <td class="td-text">
                                {{ tag.text }}
                            </td>
                            <td class="d-flex flex-row flex-justify-start flex-align-start flex-wrap">
                                <div v-for="(attlist, attlist_idx) in dtd.tag_dict[tag.tag].attlists"
                                    v-if="!['id','spans','text','tag'].contains(attlist.name)"
                                    class="tag-attr-box mr-1 d-flex flex-column">
                                    <div class="tag-attr-name">
                                        {{ attlist.name }}
                                        <span v-if="attlist.require == 'REQUIRED'"
                                            class="clr-red">
                                            *
                                        </span>
                                        <span v-else>
                                            &nbsp;
                                        </span>
                                    </div>
                                    
                                    <div v-if="attlist.vtype == 'list'">
                                        <select class="tag-attr-select"
                                            v-bind:id="'form-'+ann_idx+'-' + anns[ann_idx].tags[tag_idx].id + '-' + attlist.name"
                                            v-model="anns[ann_idx].tags[tag_idx][attlist.name]"
                                            @change="on_change_attr_value">
                                            <option v-for="val in attlist.values"
                                                v-bind:value="val">
                                                {{ val }}
                                            </option>
                                            <option value="">&nbsp;</option>
                                        </select>
                                    </div>
                                    <div v-else-if="attlist.vtype == 'text'">
                                        <input type="text"
                                            class="tag-attr-input"
                                            v-bind:id="'form-'+ann_idx+'-' + anns[ann_idx].tags[tag_idx].id + '-' + attlist.name"
                                            v-model="anns[ann_idx].tags[tag_idx][attlist.name]"
                                            @input="on_input_attr_value">
                                    </div>
                                    <div v-else-if="attlist.vtype == 'idref'">
                                        <select class="tag-attr-select"
                                            v-bind:id="'form-'+ann_idx+'-' + anns[ann_idx].tags[tag_idx].id + '-' + attlist.name" 
                                            v-model="anns[ann_idx].tags[tag_idx][attlist.name]"
                                            @change="on_change_idref_value">
                                            <option v-for="s_etag, s_etag_idx in get_tags_by_type(anns[ann_idx], dtd, 'etag')"
                                                v-bind:value="s_etag.id">
                                                {{ s_etag.id }}
                                                |
                                                {{ s_etag.tag }}
                                                -
                                                {{ s_etag.text }}
                                            </option>
                                        </select>
                                    </div>
                                    <div v-else>
                                        <input type="text"
                                            class="tag-attr-input"
                                            v-bind:id="'form-'+ann_idx+'-' + anns[ann_idx].tags[tag_idx].id + '-' + attlist.name" 
                                            v-model="anns[ann_idx].tags[tag_idx][attlist.name]"
                                            @input="on_input_attr_value">
                                    </div>
                                </div>
                                
                                
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- the ui for corpus -->
    <div v-show="section=='corpus'" id="main_ui" 
        class="main-ui container-fluid">
        <div class="w-100 d-flex flex-row" style="height: calc(100% + 10px);">

            <div class="box w-100">
                <div class="box-header">
                    <h4>
                        <i class="fa fa-list-ul"></i>
                        Corpus Files
                    </h4>
                </div>

                <div class="box-body" style="overflow-y: auto;">
                    <table class="table striped">
                        <tr>
                            <th>#</th>
                            <th>TXT File Name</th>
                            <th>&nbsp;</th>
                            <th>XML File Name</th>
                        </tr>
                        <tr v-for="txt_ann, txt_ann_idx in txt_anns">
                            <td>
                                {{ txt_ann_idx + 1 }}
                            </td>
                            <td>
                                <i class="far fa-file-alt"></i>
                                {{ txt_ann._filename }}
                            </td>
                            <td>
                                <span>
                                    <i class="fa fa-arrow-right"></i>
                                </span>
                            </td>
                            <td>
                                <span v-if="txt_xmls.length > txt_ann_idx">
                                    <i class="far fa-file-code"></i>
                                    {{ get_new_xml_filename(txt_xmls[txt_ann_idx].fn) }}

                                    <span>
                                        <a href="javascript:void(0);"
                                            v-on:click="download_txt_xml(txt_ann_idx)"
                                            v-bind:title="'Download ' + get_new_xml_filename(txt_xmls[txt_ann_idx].fn)">
                                            <i class="fa fa-download"></i>
                                            Download
                                        </a>
                                    </span>
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <!-- /.box -->
            

        </div>
    </div>


    <div v-show="section=='ruleset'" id="main_ui"
        class="main-ui container-fluid">
        <div class="w-100 d-flex flex-row" style="height: calc(100% + 10px);">
            <div class="box w-100">
                <div class="box-header">
                    <h4>
                        <i class="fa fa-list-ul"></i>
                        Annotated Texts
                    </h4>
                </div>
                <div v-if="dtd != null && anns.length > 0"
                    class="box-body" style="overflow-y: auto;">
                    <div class="d-flex flex-column w-100 h-100">

                        <div v-for="(tag_def, tag_def_idx) in dtd.etags"
                            class="ruleset-tag-item d-flex flex-row mb-1 pt-1 pb-1">
                            <div class="ruleset-tag-name pl-2 d-flex flex-row flex-justify-between"
                                v-bind:class="'border-tag-' + tag_def.name">
                                <div>
                                    <i class="fa fa-tag"
                                        v-bind:class="'fg-tag-' + tag_def.name">
                                    </i>
                                    {{ tag_def.name }}
                                </div>
                                <div v-if="hint_dict.hasOwnProperty(tag_def.name)"
                                    class="mr-2">
                                    {{ hint_dict[tag_def.name].texts.length }}
                                </div>
                                <div v-else>
                                    -
                                </div>
                            </div>

                            <div v-if="hint_dict.hasOwnProperty(tag_def.name)"
                                class="ruleset-tag-info d-flex flex-row flex-wrap">
                                <div v-for="(text_info, text) in hint_dict[tag_def.name].text_dict"
                                    class="ruleset-tag-text mr-2 mb-2 d-flex flex-column">
                                    <div v-on:click="hint_dict[tag_def.name].text_dict[text]._is_shown = !hint_dict[tag_def.name].text_dict[text]._is_shown">
                                        <span class="ruleset-tag-text-count"
                                            v-bind:title="'Annotated ' + text_info.count + ' times'">
                                            <i v-if="text_info._is_shown"
                                                class="fa fa-caret-down"></i>
                                            <i v-else
                                                class="fa fa-caret-right"></i>
                                            {{ hint_dict[tag_def.name].text_dict[text].count }}
                                        </span>
                                        <span class="ruleset-tag-text-str">
                                            {{ text }}
                                        </span>
                                    </div>
                                    <div v-show="text_info._is_shown"
                                        class="ruleset-tag-text-filelist">
                                        <div v-for="(fn_v, fn) in text_info.ann_fn_dict"
                                            v-on:click="show_ann_file(fn)"
                                            class="ruleset-tag-text-filelist-item">
                                            <span class="ruleset-tag-text-filelist-item-count">
                                                {{ fn_v }}
                                            </span>
                                            <i class="fa fa-angle-right ml-1 mr-1"></i>
                                            <span>
                                                {{ fn }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- the ui for iaa -->
    <div v-show="section=='iaa'" id="main_ui" 
        class="main-ui container-fluid">
        <div class="w-100 d-flex flex-row" style="height: calc(100% + 10px);">

            <div id="mui_iaa_summary" class="d-flex h-100 mr-1">
                <div v-if="dtd != null && iaa_dict != null" class="box h-100">
                    <div class="box-header">
                        <h4>
                            <i class="fa fa-list-ul"></i>
                            Summary
                        </h4>
                    </div>
                    <div class="box-body">

                        <div>
                            <div class="iaa-row iaa-row-header d-flex flex-row">
                                <div class="iaa-bar-name-box d-flex flex-row flex-align-center flex-justify-start mr-1">
                                    Tag Name
                                </div>
                                <div class="iaa-bar-box d-flex flex-row flex-align-center flex-justify-start">
                                    F1
                                </div>
                            </div>

                            <!-- special for the overall result -->
                            <div class="iaa-row d-flex flex-row"
                                v-bind:class="{'iaa-row-actived': iaa_display_tag_name == '__all__'}"
                                v-on:click="iaa_display_tag_name = '__all__'">
                                <div class="iaa-bar-name-box d-flex flex-row flex-align-center flex-justify-start mr-1">
                                    OVERALL
                                </div>
                                <div class="iaa-bar-box d-flex flex-row flex-align-center flex-justify-start">
                                    <div v-bind:style="'width:' + to_width(iaa_dict.all.f1) + 'px'"
                                        class="iaa-bar">
                                        &nbsp;
                                    </div>
                                    <div class="ml-1">
                                        <span style="font-size: 1.2em; font-weight: bold;">
                                            {{ to_fixed(iaa_dict.all.f1) }}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- for each tag -->
                            <div v-for="etag in dtd.etags"
                                class="iaa-row d-flex flex-row"
                                v-bind:class="{'iaa-row-actived': iaa_display_tag_name == etag.name}"
                                v-on:click="iaa_display_tag_name = etag.name">
                                <div class="iaa-bar-name-box d-flex flex-row flex-align-center flex-justify-start mr-1">
                                    <i class="fa fa-tag mr-1"
                                        v-bind:class="'fg-tag-' + etag.name">
                                    </i>
                                    <span>
                                        {{ etag.name }}
                                    </span>
                                </div>
                                <div class="iaa-bar-box d-flex flex-row flex-align-center flex-justify-start mr-1">
                                    <div v-bind:style="'width:' + to_width(iaa_dict.tag[etag.name].f1) + 'px'"
                                        class="iaa-bar">
                                        &nbsp;
                                    </div>
                                    <div class="ml-1">
                                        {{ to_fixed(iaa_dict.tag[etag.name].f1) }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <p>
                                Text Matched Files: <b>{{ iaa_dict.stat.matched_hashcodes.length }}</b>
                            </p>
                            <p>
                                Duplicated Files: <b>{{ iaa_dict.stat.duplicates.length }}</b>
                            </p>
                            <p>
                                Unmatched Files: <b>{{ iaa_dict.stat.unmatched.length }}</b>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="mui_iaa_anns" class="d-flex h-100 ml-1 mr-1">
                <div v-if="dtd != null && iaa_dict != null" class="box w-100 h-100">
                    <div class="box-header">
                        <h4>
                            <i class="fa fa-list"></i>
                            Annotation Files
                        </h4>
                    </div>

                    <div class="box-body">

                        <div class="iaa-row iaa-row-header d-flex flex-row">
                            <div class="iaa-bar-filename-box d-flex flex-row flex-align-center flex-justify-start mr-1">
                                File names
                            </div>
                            <div class="iaa-bar-box d-flex flex-row flex-align-center flex-justify-start">
                                <span v-if="iaa_display_tag_name == '__all__'">
                                    OVERALL
                                </span>
                                <span v-else>
                                    <i class="fa fa-tag mr-1"
                                        v-bind:class="'fg-tag-' + iaa_display_tag_name">
                                    </i>
                                    <span>
                                        {{ iaa_display_tag_name }}
                                    </span>
                                </span>
                                &nbsp;
                                <span>
                                    F1
                                </span>
                            </div>
                        </div>

                        <div v-for="ann_rst, ann_hashcode in iaa_dict.ann"
                            class="iaa-row d-flex flex-row"
                            v-bind:class="{'iaa-row-actived': iaa_display_hashcode == ann_hashcode}"
                            v-on:click="iaa_display_hashcode = ann_hashcode">
                            <div class="iaa-bar-filename-box d-flex flex-column flex-align-center flex-justify-start mr-1">
                                <div class="iaa-bar-filename w-100">
                                    A: {{ ann_rst.anns[0]._filename }}
                                </div>
                                <div class="iaa-bar-filename w-100">
                                    B: {{ ann_rst.anns[1]._filename }}
                                </div>
                                <div class="iaa-bar-filename w-100">
                                    <span title="Set check"
                                        v-on:click="iaa_gs_dict[ann_hashcode].ann._has_star = !iaa_gs_dict[ann_hashcode].ann._has_star">
                                        <span v-if="iaa_gs_dict[ann_hashcode].ann._has_star">
                                            <i class="fa fa-check-circle fg-emerald"></i>
                                        </span>
                                        <span v-else>
                                            <i class="far fa-circle"></i>
                                        </span>
                                    </span>
                                    
                                    GS: {{ iaa_gs_dict[ann_hashcode].ann._filename }}
                                </div>
                            </div>

                            <div class="d-flex flex-column">
                                <div class="iaa-bar-box d-flex flex-row flex-align-center flex-justify-start mr-1">
                                    <div v-bind:style="'width:' + to_width(get_rst(ann_rst.rst)['f1']) + 'px'"
                                        class="iaa-bar">
                                        &nbsp;
                                    </div>
                                    <div class="iaa-bar-value ml-1">
                                        {{ to_fixed(get_rst(ann_rst.rst)['f1']) }}
                                    </div>
                                </div>
                                <div class="iaa-file-cm-box">
                                    <span class="mr-2">
                                        <span class="iaa-op-50">AB: </span>
                                        {{ get_rst(ann_rst.rst).cm.tp }}
                                    </span>
                                    <span class="mr-2">
                                        <span class="iaa-op-50">A+: </span>
                                        {{ get_rst(ann_rst.rst).cm.fp }}
                                    </span>
                                    <span class="mr-2">
                                        <span class="iaa-op-50">B+: </span>
                                        {{ get_rst(ann_rst.rst).cm.fn }}
                                    </span>
                                </div>
                                <div class="iaa-file-gs-box">
                                    <span class="mr-2">
                                        <span class="iaa-op-50">
                                            <span v-if="iaa_display_tag_name == '__all__'">
                                                OVERALL
                                            </span>
                                            <span v-else>
                                                {{ iaa_display_tag_name }}
                                            </span>
                                            in GS:
                                        </span> 
                                        {{ count_gs_tags(ann_hashcode) }}
                                    </span>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>

            <div id="mui_iaa_tags" class="d-flex h-100 ml-1">
                <div v-if="dtd != null && iaa_dict != null && iaa_display_hashcode != null" class="box w-100 h-100">
                    <div class="box-header">
                        <h4>
                            <i class="fa fa-tag"></i>
                            Annotated Tags
                        </h4>
                    </div>

                    <div v-if="iaa_display_hashcode != null"
                        class="box-body d-flex flex-column">
                        <div class="w-100 d-flex flex-row">

                            <div class="iaa-tag-detail-header iaa-tag-detail-a"
                                :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                <i class="fa fa-user"></i>
                                A 
                                {{ iaa_dict.ann[iaa_display_hashcode].anns[0]._filename }}
                            </div>

                            <div class="iaa-tag-detail-header"
                                :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                <i class="fa fa-user"></i>
                                B
                                {{ iaa_dict.ann[iaa_display_hashcode].anns[1]._filename }}
                            </div>

                            <div v-if="iaa_display_adj_panel"
                                v-on:click="iaa_gs_dict[iaa_display_hashcode].ann._has_star = !iaa_gs_dict[iaa_display_hashcode].ann._has_star"
                                title="Set check"
                                class="iaa-tag-detail-header iaa-tag-detail-g iaa-tag-detail-g-header iaa-w-20">
                                <span v-if="iaa_gs_dict[iaa_display_hashcode].ann._has_star">
                                    <i class="fa fa-check-circle fg-emerald"></i>
                                </span>
                                <span v-else>
                                    <i class="far fa-circle"></i>
                                </span>
                                <span>
                                    {{ iaa_gs_dict[iaa_display_hashcode].ann._filename }}
                                </span>
                                
                            </div>
                            
                        </div>

                        <div v-for="tag_rst, tag_name in iaa_dict.ann[iaa_display_hashcode].rst.tag"
                            v-if="iaa_display_tag_name == '__all__' || iaa_display_tag_name == tag_name"
                            class="w-100 mb-2">
                                
                            <div class="iaa-tag-name d-flex flex-row">
                                <div class="iaa-tag-name-ab mr-1"
                                    :class="{'iaa-w-80': iaa_display_adj_panel, 'iaa-w-100': !iaa_display_adj_panel}">
                                    <i class="fa fa-tag mr-1"
                                        v-bind:class="'fg-tag-' + tag_name">
                                    </i>
                                    <span class="mr-2">
                                        {{ tag_name }}
                                    </span>
                                    <span class="mr-2">
                                        AB: {{ tag_rst.cm.tp }}
                                    </span>
                                    <span class="mr-2">
                                        A+: {{ tag_rst.cm.fp }}
                                    </span>
                                    <span class="mr-2">
                                        B+: {{ tag_rst.cm.fn }}
                                    </span>
                                </div>

                                <div v-if="iaa_display_adj_panel"
                                    class="iaa-tag-name-g iaa-tag-detail-g iaa-w-20">
                                    <i class="fa fa-tag mr-1"
                                        v-bind:class="'fg-tag-' + tag_name">
                                    </i>
                                    <span class="mr-2">
                                        {{ tag_name }}
                                    </span>
                                    <span v-if="iaa_gs_dict != null">
                                        Total: {{ count_iaa_gs_tag_notnull(iaa_gs_dict[iaa_display_hashcode].rst[tag_name]) }}
                                    </span>
                                    <span v-else>
                                        &nbsp;
                                    </span>
                                </div>
                            </div>

                            <div v-if="iaa_display_tags_tp"
                                class="iaa-tag-rsts-tp w-100">
                                <!-- last, show the TP group -->
                                <div v-for="tags_tp, tag_idx in tag_rst.cm.tags.tp"
                                    class="iaa-tag-detail w-100 d-flex flex-row">
                                    <div class="iaa-tag-detail-a"
                                        :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                        <iaa-tag-info
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'tp'"
                                            v-bind:from="'a'"
                                            v-bind:tag="tags_tp[0]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_dict.ann[iaa_display_hashcode].anns[0]"
                                            v-bind:dtd="dtd"
                                            v-bind:iaa_display_tags_context="iaa_display_tags_context"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info>
                                    </div>
                                    <div class="iaa-tag-detail-b"
                                        :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                        <iaa-tag-info
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'tp'"
                                            v-bind:from="'b'"
                                            v-bind:tag="tags_tp[1]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_dict.ann[iaa_display_hashcode].anns[1]"
                                            v-bind:dtd="dtd"
                                            v-bind:iaa_display_tags_context="iaa_display_tags_context"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info>
                                    </div>
                                    <div v-if="iaa_display_adj_panel && iaa_gs_dict != null"
                                        class="iaa-tag-detail-g iaa-w-20">
                                        
                                        <iaa-tag-info-gs
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'tp'"
                                            v-bind:tag_obj="iaa_gs_dict[iaa_display_hashcode].rst[tag_name].tp[tag_idx]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_gs_dict[iaa_display_hashcode].ann"
                                            v-bind:dtd="dtd"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info-gs>

                                    </div>
                                </div>

                            </div>                            

                            <div class="iaa-tag-rsts-fp w-100">
                                <!-- first, show the FP group -->
                                <div v-for="tags_fp, tag_idx in tag_rst.cm.tags.fp"
                                    class="iaa-tag-detail w-100 d-flex flex-row">
                                    <div class="iaa-tag-detail-a"
                                        :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                        <iaa-tag-info
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'fp'"
                                            v-bind:from="'a'"
                                            v-bind:tag="tags_fp[0]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_dict.ann[iaa_display_hashcode].anns[0]"
                                            v-bind:dtd="dtd"
                                            v-bind:iaa_display_tags_context="iaa_display_tags_context"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info>
                                    </div>

                                    <div class="iaa-tag-detail-b"
                                        :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                        <iaa-tag-info
                                            v-if="tags_fp[1] != null"
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'fp'"
                                            v-bind:from="'b'"
                                            v-bind:tag="tags_fp[1]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_dict.ann[iaa_display_hashcode].anns[1]"
                                            v-bind:dtd="dtd"
                                            v-bind:iaa_display_tags_context="iaa_display_tags_context"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info>
                                    </div>

                                    <div v-if="iaa_display_adj_panel && iaa_gs_dict != null"
                                        class="iaa-tag-detail-g iaa-w-20">
                                        <iaa-tag-info-gs
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'fp'"
                                            v-bind:tag_obj="iaa_gs_dict[iaa_display_hashcode].rst[tag_name].fp[tag_idx]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_gs_dict[iaa_display_hashcode].ann"
                                            v-bind:dtd="dtd"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info-gs>
                                    </div>
                                </div>
                            </div>

                            <div class="iaa-tag-rsts-fn w-100">
                                <!-- second, show the FN group -->
                                <div v-for="tags_fn, tag_idx in tag_rst.cm.tags.fn"
                                    class="iaa-tag-detail w-100 d-flex flex-row">
                                    <div class="iaa-tag-detail-a"
                                        :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                        &nbsp;
                                    </div>
                                    <div class="iaa-tag-detail-b"
                                        :class="{'iaa-w-40': iaa_display_adj_panel, 'iaa-w-50': !iaa_display_adj_panel}">
                                        <iaa-tag-info
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'fn'"
                                            v-bind:from="'b'"
                                            v-bind:tag="tags_fn[1]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_dict.ann[iaa_display_hashcode].anns[1]"
                                            v-bind:dtd="dtd"
                                            v-bind:iaa_display_tags_context="iaa_display_tags_context"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info>
                                    </div>

                                    <div v-if="iaa_display_adj_panel"
                                        class="iaa-tag-detail-g iaa-w-20">
                                        <iaa-tag-info-gs
                                            v-bind:hashcode="iaa_display_hashcode"
                                            v-bind:cm="'fn'"
                                            v-bind:tag_obj="iaa_gs_dict[iaa_display_hashcode].rst[tag_name].fn[tag_idx]"
                                            v-bind:tag_idx="tag_idx"
                                            v-bind:ann="iaa_gs_dict[iaa_display_hashcode].ann"
                                            v-bind:dtd="dtd"
                                            v-bind:force_update="force_module_update"
                                        ></iaa-tag-info-gs>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <!-- the ui for statistics -->
    <div v-show="section=='statistics'" id="main_ui" 
        class="main-ui container-fluid">
        <div class="w-100 d-flex flex-row" style="height: calc(100% + 10px);">

            <div id="mui_stat_summary" class="d-flex h-100">
                <div class="box w-100">
                    <div class="box-header">
                        <h4>
                            <i class="fa fa-list-ul"></i>
                            Summary
                        </h4>
                    </div>

                    <div class="box-body">
                        <div class="box-body-item d-flex flex-row flex-justify-between">
                            <div>
                                # of documents: 
                            </div>
                            <div class="mr-2">
                                {{ anns.length }}
                            </div>
                        </div>

                        <div class="box-body-item d-flex flex-row flex-justify-between">
                            <div>
                                # of tags in DTD: 
                            </div>
                            <div v-if="dtd != null" class="mr-2">
                                {{ dtd.etags.length }}
                            </div>
                            <div v-else class="mr-2">
                                0
                            </div>
                        </div>

                        <div class="box-body-item d-flex flex-row flex-justify-between">
                            <div>
                                # of annotations: 
                            </div>
                            <div class="mr-2">
                                {{ count_all_tags(anns) }}
                            </div>
                        </div>

                        <div class="box-body-item d-flex flex-row flex-justify-between">
                            <div>
                                # of annotations per tag: 
                            </div>
                            <div class="mr-2">
                                {{ calc_avg_tags_per_def(anns, dtd) }}
                            </div>
                        </div>

                        <div class="box-body-item d-flex flex-row flex-justify-between">
                            <div>
                                # of annotations per document: 
                            </div>
                            <div class="mr-2">
                                {{ calc_avg_tags_per_doc(anns) }}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box -->
            </div>
            <div class="h-splitter"></div>
            <div id="mui_stat_charts" class="d-flex">

        </div>

        </div>
    </div>


    <!-- the context menu -->
    <div v-if="dtd != null"
        style="display: none;"
        id="ctxmenu_sel">
        <!-- <li class="ui-widget-header"
            v-on:click="close_ctxmenu">Tags:</li> -->
        <li class="ctxmenu-item"
            v-for="etag, tag_idx in dtd.etags"
            v-on:click="add_etag_by_ctxmenu(etag)">
            <div v-bind:id="'ctxmenu-item-' + etag.name">
                <i v-bind:class="'fa fa-tag fg-tag-' + etag.name"></i>
                <span v-if="etag.hasOwnProperty('shortcut')"
                    class="badge-shortcut mr-1">
                    {{ etag.shortcut }}
                </span>
                <span>
                    {{ etag.name }}
                </span>
            </div>
        </li>
    </div>
    <div v-else
        id="ctxmenu_sel">

    </div>

    <!-- the tag click menu -->
    <div v-if="dtd != null"
        style="display: none;"
        id="popmenu_tag">
        <li class="ui-widget-header"
            v-on:click="close_popmenu">
            TAG <i class="fa fa-tag"></i>
            <b>{{ clicked_tag_id }}</b>
        </li>

        <div v-if="is_linking">
            <li v-for="att, att_idx in linking_atts"
                v-on:click="popmenu_set_linking(att_idx)"
                class="ctxmenu-item">
                <div>
                    <i class="fa fa-link"
                        v-bind:class="'fg-tag-' + linking_tag_def.name">
                    </i>
                    <b>{{ linking_tag_def.name }}</b>
                    -
                    <i>{{ att.name }}</i>
                </div>
            </li>

            <li class="ctxmenu-divider"></li>
            <li class="ctxmenu-item"
                v-on:click="cancel_linking()">
                <div>
                    <i class="far fa-times-circle"></i>
                    Cancel current linking
                </div>
            </li>
        </div>

        <div v-else>
            <li class="ctxmenu-item"
                v-for="ltag, ltag_idx in dtd.ltags"
                v-on:click="popmenu_start_linking(ltag)">
                <div>
                    <i class="fa fa-link"
                        v-bind:class="'fg-tag-' + ltag.name">
                    </i>
                    <b>{{ ltag.name }}</b>
                    -
                    <i>{{ get_idref_attlist_by_seq(ltag).name }}</i>
                </div>
            </li>
        </div>

        <li class="ctxmenu-divider"></li>
        <li class="ctxmenu-item"
            v-on:click="popmenu_del_tag()">
            <div>
                <i class="far fa-trash-alt"></i>
                Delete this tag
            </div>
        </li>
    </div>
    <div v-else
        id="popmenu_tag">

    </div>
    
</div>
{% endblock %}

{% block script %}
<script>
var isIE = /*@cc_on!@*/false || !!document.documentMode;
var isCHROME = false;
var CHROME_VERSION = null;
var CHROME_VERSION_MAJOR = null;
if (isIE) {
    document.getElementById('ss-msg').innerHTML = 'The visualization used in this website require advanced web technologies, which are <b>NOT</b> supported by Internet Explorer.<br>Try using Google Chrome, Apple Safari, Mozilla Firefox or other modern browsers to access:<br><span style="font-size:1.2em;">' + location.href + '</span>';
} else {
    let user_agent = navigator.userAgent.toLowerCase();
    let mgs = user_agent.match(/chrome\/([\d\.]+)/);
    if (mgs == null) {
    } else {
        isCHROME = true;
        CHROME_VERSION = mgs[1];
        CHROME_VERSION_MAJOR = parseInt(CHROME_VERSION.split('.')[0]);
    }
}
</script>

<!-- jszip -->
<script src="https://stuk.github.io/jszip/dist/jszip.js"></script>
<!-- filesaver -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
<!-- dayjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/dayjs.min.js"></script>
<!-- js cookie -->
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<!-- jquery-ui -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<!-- code mirror -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.js"></script>
<!-- code mirror addon -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/addon/selection/active-line.min.js"></script>
<!-- numjs -->
<script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
<!-- compromise -->
<script src="https://unpkg.com/compromise"></script>
<!-- chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

// The file helper 
{% include 'js/fs_helper.js' %}

// The DTD parser
{% include 'js/dtd_parser.js' %}

// The Ann parser
{% include 'js/ann_parser.js' %}

// The Rulepack toolkit
{% include 'js/erp_toolkit.js' %}

// The spaCy toolkit
{% include 'js/spacy_toolkit.js' %}

// The IAA Calculator
{% include 'js/iaa_calculator.js' %}

// The NLP toolkit
{% include 'js/nlp_toolkit.js' %}

// The Vue APP
{% include 'js/app_hotpot.js' %}

// The Tag Info Vue Module
{% include 'js/vpp_iaa_tag_info.js' %}

// The Tag Info Vue Module for Gold Standard
{% include 'js/vpp_iaa_tag_info_gs.js' %}

var jarvis = {
    init: function() {
        // too bad ...
        if (isIE) { return 0; }

        if (!isCHROME) { 
            this.ssmsg('Please use the latest Google Chrome browser');
            return 0; 
        }

        app_hotpot.init();

        jarvis.ssmsg('Initializated')
        setTimeout('jarvis.ssclose();', 500);

        $(window).resize(function() {
            app_hotpot.resize();
        });

        var s = this.get_url_paramter('s');
        if (s == 'yes') {
            this.load_sample();
        }
        // this.load_sample();
    },

    load_sample: function() {
        $.get(
            '/static/data/vpp_data_sample.json', 
            {
                rnd: Math.random()
            }, 
            function(data) {
                Object.assign(app_hotpot.vpp.$data, data);
                app_hotpot.set_dtd(
                    app_hotpot.vpp.$data.dtd
                );
            }, 
            'json'
        );
    },


    get_url_paramter: function(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    },

    msg: function(s, cls) {
        if (typeof(cls) == 'undefined') {
            cls = 'info';
        }
        s = '<i class="fa fa-info-circle"></i> ' + s; 
        var notify = Metro.notify;
        notify.setup({
            width: 300,
            timeout: 4000,
            animation: 'swing'
        });
        notify.create(s, null, { 
            cls: cls
        });
    },

    ssmsg: function(msg) {
        $('#ss-msg').html(msg);
    },

    ssclose: function() {
        $('#start-screen').hide();
    },

    save_json: function(obj, fn) {
        var json_text = JSON.stringify(obj, null, 4);
        var blob = new Blob([json_text], {type: "text/json;charset=utf-8"});
        saveAs(blob, fn);
    },

    save_vpp: function() {
        this.save_json(
            app_hotpot.vpp.$data,
            'vpp_data_sample.json'
        );
    }
}


$(document).ready(function () {
    jarvis.init();
})
</script>
{% endblock %}